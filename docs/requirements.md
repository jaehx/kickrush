# 요구사항 정의서

## 1. 서비스 개요
- 한 줄 설명: 한정판 신발 드롭(FCFS)에서 대규모 동시성 트래픽과 재고 정합성을 보장하는 백엔드 시스템
- 문제/가치: 발매 시점 폭주 트래픽에서 초과 판매/중복 주문을 방지하고 재고를 원자적으로 관리
- 대상 사용자: 구매자(일반 회원), 운영자/관리자, 비회원(조회만)
- 성공 지표(KPI/OKR): 초과 판매 0건, 중복 주문 0건, 주문 생성 성공률 99%+

## 2. 사용자 시나리오
- 시나리오 1: 비회원이 발매/상품 목록을 조회한다
- 시나리오 2: 회원이 발매 시점에 주문을 시도한다
- 시나리오 3(선택): 운영자가 상품/발매/재고를 등록·수정하고 주문 취소 시 재고가 복구된다

## 3. 범위
- In Scope: 상품/발매/재고/주문/회원 도메인, 동시성 제어(재고 차감), 중복 주문 방지, JWT 인증(예정), REST API
- Out of Scope: 결제/배송/정산/알림 서비스, 외부 마켓 연동, 프론트 UI 완성(프론트는 예정)

## 4. 기능 요구사항
### 4.1 기능 목록
- [ ] 상품(Shoe) 등록/조회 기능
- [ ] 발매(Release) 등록/조회 기능
- [ ] 재고(Stock) 관리 및 원자적 차감 기능
- [ ] 주문(Order) 생성/조회/취소 기능
- [ ] 회원(Member) 가입 및 인증(JWT) 기능
- [ ] 중복 주문 방지 기능
- [ ] 동시성 제어(Pessimistic Lock) 기능
- [ ] 비회원 조회 API 접근 허용

### 4.2 기능 상세
- 기능 A: 발매/상품 조회 API
- 설명: 발매 목록 및 상세 정보를 제공한다(비회원 접근 가능)
- 입력: 선택적 필터(상태, 기간)
- 출력: 발매 리스트/상세
- 예외/오류: 잘못된 파라미터
- 권한/역할: 비회원/회원 모두 조회 가능
- 수용 기준: 비회원도 정상 조회 가능, 회원/비회원 동일 응답 규격

- 기능 B: 재고 차감(동시성 제어 포함)
- 설명: 발매 주문 시 재고를 원자적으로 차감하고, 동시 요청에서도 초과 판매를 방지한다
- 입력: releaseId, memberId, quantity(기본 1)
- 출력: 차감 성공 여부, 남은 재고
- 예외/오류: 재고 부족, 잠금 타임아웃, 존재하지 않는 발매/상품
- 권한/역할: 로그인 회원만 가능
- 수용 기준: 동시 요청에서도 초과 판매 0건, 실패 요청은 재고 부족 오류 반환

- 기능 C: 주문 생성 및 중복 주문 방지
- 설명: 동일 회원이 동일 발매에 중복 주문하지 못하도록 차단한다
- 입력: releaseId, memberId, 주문 정보
- 출력: 주문 생성 결과, 주문 ID
- 예외/오류: 중복 주문, 재고 부족
- 권한/역할: 로그인 회원만 가능
- 수용 기준: 같은 회원의 동일 발매 주문이 2회 이상 생성되지 않음

- 기능 D: 주문 취소 및 재고 복구
- 설명: 주문 취소 시 재고를 복구하고 주문 상태를 변경한다
- 입력: orderId
- 출력: 취소 결과, 재고 복구 상태
- 예외/오류: 취소 불가 상태, 주문 없음
- 권한/역할: 주문 생성한 회원 또는 관리자
- 수용 기준: 취소 후 재고 수량이 정확히 복구됨

## 5. 비기능 요구사항
- 성능: 목표 트래픽 규모 미정(추후 정의 필요)
- 보안: JWT 기반 인증, 인증/인가 실패 시 표준 에러 응답
- 가용성/복구: 재고/주문 정합성 보장을 위한 트랜잭션, 장애 시 롤백 가능
- 운영/모니터링: 요청/에러 로그, 재고/주문 이상 탐지 지표
- 규정/법무/개인정보: 정책 미정(추후 정의 필요)
- 접근성/국제화: 초기 범위 제외(가정)

## 6. 데이터/연동
- 데이터 소스: RDBMS(JPA), 테스트용 H2, 캐시/락용 Redis
- 외부 연동: 없음(가정)
- 저장/보관/삭제 정책: 미정(추후 정의 필요)

## 7. 의존성
- 팀/조직 의존성: 없음(개인/학습 프로젝트 가정)
- 기술/플랫폼 의존성: Java 17, Spring Boot 3.2.2, Spring Data JPA/Redis, Gradle 8.x

## 8. 리스크/가정/미해결 질문
- 리스크: Pessimistic Lock로 인한 병목/타임아웃, 락 경합 시 처리량 저하
- 가정: 결제/배송 연동은 범위 외, 발매/상품 CRUD는 관리자 기능으로 제공
- 미해결 질문:
- 목표 트래픽 규모/응답시간 목표 수치
- 주문/회원 데이터 보관 기간 및 삭제 정책
- 비회원 접근 허용 범위(조회 외 제한 필요 여부)

## 9. 결정 로그
- 결정 1:
- 배경: 동시성 문제 해결이 핵심 목표
- 선택: 재고 차감에 Pessimistic Lock 적용
- 이유: 초과 판매 방지와 정합성 우선

## 10. 검증/테스트 관점
- 기능별 수용 기준 요약: 비회원 조회 허용, 재고 차감/중복 주문/취소 복구 동시성 테스트 포함
- 테스트 전략: TDD 기반 유닛/리포지토리/서비스 테스트, 동시성 테스트 추가, API 레이어 테스트

## 11. 일정/마일스톤(선택)
- 1차 목표일: 미정
- 주요 마일스톤: Phase 2 재고 관리 → Phase 3 주문 처리 → Phase 4 회원 관리 → Phase 5 API 레이어
